<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8-Regime Trade Log</title>
    <style>
        @media print {
            @page {
                size: A4 landscape;
                margin: 0.4in;
            }
            body {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            .no-print {
                display: none;
            }
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border-radius: 8px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: space-between;
            align-items: center;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        .btn.danger {
            background: #ef4444;
        }
        
        .btn.danger:hover {
            background: #dc2626;
        }
        
        .btn.success {
            background: #22c55e;
        }
        
        .btn.success:hover {
            background: #16a34a;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            padding: 15px;
            border-radius: 8px;
            border: 2px solid;
            text-align: center;
        }
        
        .stat-card.wins {
            border-color: #22c55e;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        }
        
        .stat-card.losses {
            border-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
        }
        
        .stat-card.total {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }
        
        .stat-card.pnl {
            border-color: #8b5cf6;
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        th {
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            border: 1px solid rgba(255,255,255,0.2);
            white-space: nowrap;
        }
        
        td {
            padding: 10px 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }
        
        tbody tr:nth-child(even) {
            background: #f9fafb;
        }
        
        tbody tr:hover {
            background: #fef3c7;
        }
        
        input, select {
            width: 100%;
            padding: 6px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .regime-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 11px;
            color: white;
        }
        
        .r0 { background: #6b7280; }
        .r1 { background: #22c55e; }
        .r2 { background: #ef4444; }
        .r3 { background: #10b981; }
        .r4 { background: #dc2626; }
        .r5 { background: #06b6d4; }
        .r6 { background: #f97316; }
        .r7 { background: #a855f7; }
        .r8 { background: #eab308; }
        
        .side-long {
            color: #22c55e;
            font-weight: bold;
        }
        
        .side-short {
            color: #ef4444;
            font-weight: bold;
        }
        
        .result-win {
            background: #dcfce7;
            color: #166534;
            font-weight: bold;
        }
        
        .result-loss {
            background: #fee2e2;
            color: #991b1b;
            font-weight: bold;
        }
        
        .delete-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .delete-btn:hover {
            background: #dc2626;
        }
        
        .instructions {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
        }
        
        .instructions h3 {
            color: #92400e;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            margin-left: 20px;
        }
        
        .instructions li {
            margin: 5px 0;
        }
        
        .col-narrow {
            width: 80px;
        }
        
        .col-medium {
            width: 100px;
        }
        
        .col-wide {
            width: 120px;
        }
        
        .col-date {
            width: 100px;
        }
        
        .col-time {
            width: 80px;
        }
        
        .footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #e5e7eb;
            text-align: center;
            color: #666;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä 8-REGIME TRADE LOG</h1>
            <p>Comprehensive Trading Journal with Performance Analytics</p>
        </div>

        <div class="instructions no-print">
            <h3>üìù How to Use This Trade Log:</h3>
            <ul>
                <li><strong>Add Trade:</strong> Click "Add New Trade" to insert a new row</li>
                <li><strong>Fill Details:</strong> Enter all trade information (regime, entry, exit, etc.)</li>
                <li><strong>Auto-Calculate:</strong> P&L, R-Multiple, and Win/Loss automatically calculated</li>
                <li><strong>Track Performance:</strong> Stats update in real-time at the top</li>
                <li><strong>Export:</strong> Use "Export to CSV" to save your data</li>
                <li><strong>Print:</strong> Click "Print Log" for a hard copy</li>
            </ul>
        </div>

        <div class="stats">
            <div class="stat-card wins">
                <div class="stat-label">Total Wins</div>
                <div class="stat-value" id="totalWins">0</div>
                <div class="stat-label" style="margin-top: 5px;">Win Rate: <span id="winRate">0%</span></div>
            </div>
            <div class="stat-card losses">
                <div class="stat-label">Total Losses</div>
                <div class="stat-value" id="totalLosses">0</div>
                <div class="stat-label" style="margin-top: 5px;">Avg Loss: <span id="avgLoss">$0</span></div>
            </div>
            <div class="stat-card total">
                <div class="stat-label">Total Trades</div>
                <div class="stat-value" id="totalTrades">0</div>
                <div class="stat-label" style="margin-top: 5px;">Avg Win: <span id="avgWin">$0</span></div>
            </div>
            <div class="stat-card pnl">
                <div class="stat-label">Total P&L</div>
                <div class="stat-value" id="totalPnL">$0</div>
                <div class="stat-label" style="margin-top: 5px;">Avg R: <span id="avgR">0R</span></div>
            </div>
        </div>

        <div class="controls no-print">
            <div>
                <button class="btn success" onclick="addTrade()">‚ûï Add New Trade</button>
                <button class="btn" onclick="exportToCSV()">üíæ Export to CSV</button>
                <button class="btn" onclick="window.print()">üñ®Ô∏è Print Log</button>
            </div>
            <div>
                <button class="btn danger" onclick="clearAll()">üóëÔ∏è Clear All</button>
            </div>
        </div>

        <div class="table-container">
            <table id="tradeLog">
                <thead>
                    <tr>
                        <th class="col-date">Date</th>
                        <th class="col-time">Time</th>
                        <th class="col-medium">Instrument</th>
                        <th class="col-narrow">Regime</th>
                        <th class="col-narrow">Side</th>
                        <th class="col-narrow">Shares</th>
                        <th class="col-narrow">Entry</th>
                        <th class="col-narrow">Stop</th>
                        <th class="col-narrow">Target</th>
                        <th class="col-narrow">Exit</th>
                        <th class="col-narrow">Risk ($)</th>
                        <th class="col-narrow">P&L ($)</th>
                        <th class="col-narrow">R-Multiple</th>
                        <th class="col-narrow">Win/Loss</th>
                        <th class="col-medium">Setup Type</th>
                        <th class="col-wide">Notes</th>
                        <th class="col-narrow no-print">Action</th>
                    </tr>
                </thead>
                <tbody id="tradeBody">
                    <!-- Trades will be added here -->
                </tbody>
            </table>
        </div>

        <div class="footer">
            <strong>8-REGIME TRADE LOG</strong> | Track every trade, analyze every regime | ¬© 2024<br>
            Discipline + Data = Success | Always follow your risk management rules
        </div>
    </div>

    <script>
        let trades = [];
        let tradeIdCounter = 1;

        // Load trades from localStorage on page load
        window.addEventListener('load', function() {
            const savedTrades = localStorage.getItem('regimeTrades');
            if (savedTrades) {
                trades = JSON.parse(savedTrades);
                tradeIdCounter = trades.length > 0 ? Math.max(...trades.map(t => t.id)) + 1 : 1;
                renderTrades();
                updateStats();
            }
        });

        // Save trades to localStorage
        function saveTrades() {
            localStorage.setItem('regimeTrades', JSON.stringify(trades));
        }

        function addTrade() {
            const now = new Date();
            const trade = {
                id: tradeIdCounter++,
                date: now.toISOString().split('T')[0],
                time: now.toTimeString().split(' ')[0].substring(0, 5),
                instrument: '',
                regime: '1',
                side: 'Long',
                shares: 0,
                entry: 0,
                stop: 0,
                target: 0,
                exit: 0,
                risk: 0,
                pnl: 0,
                rMultiple: 0,
                result: '',
                setupType: '',
                notes: ''
            };
            
            trades.push(trade);
            renderTrades();
            saveTrades();
        }

        function deleteTrade(id) {
            if (confirm('Are you sure you want to delete this trade?')) {
                trades = trades.filter(t => t.id !== id);
                renderTrades();
                updateStats();
                saveTrades();
            }
        }

        function updateTrade(id, field, value) {
            const trade = trades.find(t => t.id === id);
            if (!trade) return;

            trade[field] = value;

            // Auto-calculate fields
            if (['shares', 'entry', 'stop', 'exit', 'side'].includes(field)) {
                const shares = parseFloat(trade.shares) || 0;
                const entry = parseFloat(trade.entry) || 0;
                const stop = parseFloat(trade.stop) || 0;
                const exit = parseFloat(trade.exit) || 0;

                // Calculate risk
                if (trade.side === 'Long') {
                    trade.risk = shares * Math.abs(entry - stop);
                    trade.pnl = shares * (exit - entry);
                } else {
                    trade.risk = shares * Math.abs(stop - entry);
                    trade.pnl = shares * (entry - exit);
                }

                // Calculate R-Multiple
                if (trade.risk > 0) {
                    trade.rMultiple = trade.pnl / trade.risk;
                } else {
                    trade.rMultiple = 0;
                }

                // Determine Win/Loss
                if (exit !== 0) {
                    trade.result = trade.pnl > 0 ? 'Win' : trade.pnl < 0 ? 'Loss' : 'BE';
                } else {
                    trade.result = '';
                }
            }

            renderTrades();
            updateStats();
            saveTrades();
        }

        function renderTrades() {
            const tbody = document.getElementById('tradeBody');
            tbody.innerHTML = '';

            trades.forEach(trade => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td><input type="date" value="${trade.date}" onchange="updateTrade(${trade.id}, 'date', this.value)"></td>
                    <td><input type="time" value="${trade.time}" onchange="updateTrade(${trade.id}, 'time', this.value)"></td>
                    <td><input type="text" value="${trade.instrument}" onchange="updateTrade(${trade.id}, 'instrument', this.value)" placeholder="SPY"></td>
                    <td>
                        <select onchange="updateTrade(${trade.id}, 'regime', this.value)">
                            ${[0,1,2,3,4,5,6,7,8].map(r => `<option value="${r}" ${trade.regime == r ? 'selected' : ''}>R${r}</option>`).join('')}
                        </select>
                    </td>
                    <td>
                        <select onchange="updateTrade(${trade.id}, 'side', this.value)">
                            <option value="Long" ${trade.side === 'Long' ? 'selected' : ''}>Long</option>
                            <option value="Short" ${trade.side === 'Short' ? 'selected' : ''}>Short</option>
                        </select>
                    </td>
                    <td><input type="number" value="${trade.shares}" onchange="updateTrade(${trade.id}, 'shares', this.value)" placeholder="100"></td>
                    <td><input type="number" step="0.01" value="${trade.entry}" onchange="updateTrade(${trade.id}, 'entry', this.value)" placeholder="100.00"></td>
                    <td><input type="number" step="0.01" value="${trade.stop}" onchange="updateTrade(${trade.id}, 'stop', this.value)" placeholder="98.00"></td>
                    <td><input type="number" step="0.01" value="${trade.target}" onchange="updateTrade(${trade.id}, 'target', this.value)" placeholder="105.00"></td>
                    <td><input type="number" step="0.01" value="${trade.exit}" onchange="updateTrade(${trade.id}, 'exit', this.value)" placeholder="104.50"></td>
                    <td>$${trade.risk.toFixed(2)}</td>
                    <td class="${trade.pnl > 0 ? 'result-win' : trade.pnl < 0 ? 'result-loss' : ''}">$${trade.pnl.toFixed(2)}</td>
                    <td class="${trade.rMultiple > 0 ? 'result-win' : trade.rMultiple < 0 ? 'result-loss' : ''}">${trade.rMultiple.toFixed(2)}R</td>
                    <td><span class="regime-badge r${trade.regime}">${trade.result}</span></td>
                    <td><input type="text" value="${trade.setupType}" onchange="updateTrade(${trade.id}, 'setupType', this.value)" placeholder="Breakout"></td>
                    <td><input type="text" value="${trade.notes}" onchange="updateTrade(${trade.id}, 'notes', this.value)" placeholder="Power cross up"></td>
                    <td class="no-print"><button class="delete-btn" onclick="deleteTrade(${trade.id})">üóëÔ∏è</button></td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function updateStats() {
            const completedTrades = trades.filter(t => t.result !== '');
            const wins = completedTrades.filter(t => t.result === 'Win');
            const losses = completedTrades.filter(t => t.result === 'Loss');
            
            const totalPnL = completedTrades.reduce((sum, t) => sum + t.pnl, 0);
            const totalR = completedTrades.reduce((sum, t) => sum + t.rMultiple, 0);
            const avgR = completedTrades.length > 0 ? totalR / completedTrades.length : 0;
            
            const avgWin = wins.length > 0 ? wins.reduce((sum, t) => sum + t.pnl, 0) / wins.length : 0;
            const avgLoss = losses.length > 0 ? losses.reduce((sum, t) => sum + t.pnl, 0) / losses.length : 0;
            
            const winRate = completedTrades.length > 0 ? (wins.length / completedTrades.length * 100) : 0;

            document.getElementById('totalWins').textContent = wins.length;
            document.getElementById('totalLosses').textContent = losses.length;
            document.getElementById('totalTrades').textContent = completedTrades.length;
            document.getElementById('totalPnL').textContent = `$${totalPnL.toFixed(2)}`;
            document.getElementById('totalPnL').style.color = totalPnL >= 0 ? '#22c55e' : '#ef4444';
            document.getElementById('winRate').textContent = `${winRate.toFixed(1)}%`;
            document.getElementById('avgWin').textContent = `$${avgWin.toFixed(2)}`;
            document.getElementById('avgLoss').textContent = `$${avgLoss.toFixed(2)}`;
            document.getElementById('avgR').textContent = `${avgR.toFixed(2)}R`;
        }

        function exportToCSV() {
            const headers = ['Date', 'Time', 'Instrument', 'Regime', 'Side', 'Shares', 'Entry', 'Stop', 'Target', 'Exit', 'Risk', 'P&L', 'R-Multiple', 'Result', 'Setup Type', 'Notes'];
            
            let csv = headers.join(',') + '\n';
            
            trades.forEach(trade => {
                const row = [
                    trade.date,
                    trade.time,
                    trade.instrument,
                    trade.regime,
                    trade.side,
                    trade.shares,
                    trade.entry,
                    trade.stop,
                    trade.target,
                    trade.exit,
                    trade.risk.toFixed(2),
                    trade.pnl.toFixed(2),
                    trade.rMultiple.toFixed(2),
                    trade.result,
                    trade.setupType,
                    `"${trade.notes}"`
                ];
                csv += row.join(',') + '\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `trade-log-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function clearAll() {
            if (confirm('Are you sure you want to delete ALL trades? This cannot be undone!')) {
                if (confirm('Really sure? All your trading history will be lost!')) {
                    trades = [];
                    tradeIdCounter = 1;
                    renderTrades();
                    updateStats();
                    saveTrades();
                }
            }
        }

        // Add 3 sample trades on first load
        if (!localStorage.getItem('regimeTrades')) {
            addTrade();
            addTrade();
            addTrade();
        }
    </script>
</body>
</html>